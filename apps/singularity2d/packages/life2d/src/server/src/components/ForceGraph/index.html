<!-- <!DOCTYPE html> -->
<html>

<head>
  <title>Chat Bot</title>
  <link rel="stylesheet" href="styles.css">
  <!-- Include Bootstrap CSS -->
  <link href="components/dialpad/dialpad.css" rel="stylesheet" />
  <!-- <link href="https://cdn.jsdelivr.net/npm/prismjs/themes/prism.css" rel="stylesheet" /> -->
  <link href="/src/styles/bootstrap.min.css" rel="stylesheet">
  <link href="/components/dialpad/dialpad.css" rel="stylesheet">
</head>

<div>
  <wallet-login></wallet-login>
  <div class="text-center text-body-tertiary header">
    <h1 class="--bs-light-text-emphasis">Day Vault</h1>
    <p style="font-size: large;">An Obsidian Vault, AI powered RPC </p>
  </div>
  <div id="protocol-view" class="container" style="display: flex;">
    <button class="btn btn-light" onclick="document.querySelector('#node-dialog').showModal()">Network</button>
    <canvas id="active-node-canvas" width="48px" height="48px"></canvas>
    <button class="btn btn-light" onclick="document.querySelector('#block-node-dialog').showModal()">Node</button>
  </div>
  <dialog class="container" id="node-dialog">
    <h1>IPFS in the Browser via Helia</h1>
    <div>
      <button class="btn btn-success" onclick="window.helia.start();alert(heliaInstance)">Start Helia</button>
      <button class="btn btn-danger" onclick="window.helia.stop()">Stop Helia</button>
    </div>
    <!-- <form class="form"> -->
    <div class="input-group">
      <button id="connect-button" class="btn btn-primary"
        onclick="window.helia.libp2p.dialProtocol(document.querySelector('#connect-input-multiaddr').value,document.querySelector('#connect-input-protocol').value);">Dial
        Protocol</button>
      <input id="connect-input-multiaddr" placeholder="Multiaddr"
        value="/ip4/127.0.0.1/tcp/35354/p2p/16Uiu2HAmVboqPtEibQihzkYNQq7gKjfbqPQFziqdU2xDv2ZEN7R3/ws"
        class="form-control" type="text">
      <input id="connect-input-protocol" placeholder="Protocol" value="/vault_ai/0.0.1" class="form-control"
        type="text">
    </div>
    <!-- </form> -->
    <h1 id="status">Node status: <span id="statusValue">Not Started</span></h1>
    <div id="nodeInfo">
      <h3>ID: <span id="nodeId">unknown</span></h3>
      <h3>Discovered Peers: <span id="discoveredPeerCount">0</span></h3>
      <h3>Connected Peers: <span id="connectedPeerCount">0</span></h3>
      <button class="btn btn-danger" style="float: right;"
        onclick="document.querySelector('#node-dialog').close()">Close</button>
    </div>
    <ul id="connectedPeersList"></ul>

    <details>
      <summary class="btn btn-warning" style="width: 100%;">View Log</summary>
      <div id="runningLog"></div>
      <style>
        #runningLog span {
          display: block;
        }
      </style>
    </details>
  </dialog>
  <dialog class="container" id="block-node-dialog">
    <h1>Select Node</h1>
    <div>
      <button class="btn btn-success" onclick="window.helia.start();alert(heliaInstance)" disabled>Start Helia</button>
      <button class="btn btn-danger" onclick="window.helia.stop()" disabled>Stop Helia</button>
    </div>
    <!-- <form class="form"> -->
    <div class="input-group">
      <button id="connect-button" class="btn btn-primary"
        onclick="window.helia.libp2p.dialProtocol(document.querySelector('#connect-input-multiaddr').value,document.querySelector('#connect-input-protocol').value);">Dial
        Protocol</button>
      <input id="connect-input-multiaddr" placeholder="Multiaddr"
        value="/ip4/127.0.0.1/tcp/35354/p2p/16Uiu2HAmVboqPtEibQihzkYNQq7gKjfbqPQFziqdU2xDv2ZEN7R3/ws"
        class="form-control" type="text">
      <input id="connect-input-protocol" placeholder="Protocol" value="/vault_ai/0.0.1" class="form-control"
        type="text">
    </div>
    <!-- </form> -->
    <section class="node-select-grid">
      <div>
        <div class="input-group">
          <button class="btn btn-light" onclick="document.querySelector('#create-node-text-area-dialog').showModal()">Create A Node</button>
          <button id="search-nodes-button" class="btn btn-primary" onclick="window.confirm('Will be able to search for input nodes')" disabled>Search Node</button>
          <input id="input-node-string" placeholder="Input Node" value="16Uiu2HAmVboqPtEibQihzkYNQq7gKjfbqPQFziqdU2xDv2ZEN7R3/ws" class="form-control" type="text" disabled>
          <button id="add-input-node-button" class="btn btn-primary" onclick="window.confirm('Will be able to add input nodes')" disabled>Add Node</button>
        </div>
      </div>
    </section>
    <button class="btn btn-danger" style="float: right;"
      onclick="document.querySelector('#block-node-dialog').close()">Close</button>
  </dialog>
  <!-- Create Node Text Area Modal -->
  <dialog class="container" id="create-node-text-area-dialog">
    <h1>Select Node</h1>
    <div>
      <button class="btn btn-success" onclick="window.helia.start();alert(heliaInstance)" disabled>Start Helia</button>
      <button class="btn btn-danger" onclick="window.helia.stop()" disabled>Stop Helia</button>
    </div>
    <!-- <form class="form"> -->
    <div class="input-group">
      <button id="connect-button" class="btn btn-primary"
        onclick="window.helia.libp2p.dialProtocol(document.querySelector('#connect-input-multiaddr').value,document.querySelector('#connect-input-protocol').value);">Dial
        Protocol</button>
      <input id="connect-input-multiaddr" placeholder="Multiaddr"
        value="/ip4/127.0.0.1/tcp/35354/p2p/16Uiu2HAmVboqPtEibQihzkYNQq7gKjfbqPQFziqdU2xDv2ZEN7R3/ws"
        class="form-control" type="text">
      <input id="connect-input-protocol" placeholder="Protocol" value="/vault_ai/0.0.1" class="form-control"
        type="text">
    </div>
    <!-- </form> -->
    <section class="node-select-grid">
      <div>
        <textarea rows="5" class="text-code-area">#!/ip4/127.0.0.1/tcp/35354/p2p/16Uiu2HAmVboqPtEibQihzkYNQq7gKjfbqPQFziqdU2xDv2ZEN7R3/ws/vault_ai/0.0.1&#10;</textarea>
      </div>
    </section>
    <button class="btn btn-danger" style="float: right;"
      onclick="document.querySelector('#create-node-text-area-dialog').close()">Close</button>
  </dialog>
  <section>
    <div id="chatContainer" class="container">
      <div class="chatMessages">
        <div id="chatMessages">
          <!-- <div id="chat-messages-container" class="system" height="200px"> -->
            <!-- <div class="canvas-container"> -->
              <!-- <div id="graph"></div> -->
            <!-- </div> -->
          <!-- </div> -->
          <!-- 
          <div id="dialpad" class="container"></div> -->
        </div>
      </div>
      <div class="input-group input-group-lg">
        <div class="input-group-append">
          <div class="custom-file btn btn-lg btn-outline-light" style="width:auto;">
            <input type="file" id="inputGroupFile01" class="form-control form-control-lg"
              aria-describedby="inputGroupFileAddon01" style="display: none;">
            <label for="inputGroupFile01">
              <img src="/src/images/2192072-200.png" style="height:2rem;width:2rem;"
                alt="Upload" style="cursor: pointer;">
            </label>
          </div>
          <style>
            .custom-file-input {
              display: none;
              /* Hide the actual input */
            }

            .custom-file label img {
              /* Add any styles here for your image */
              width: 50px;
              /* Example size */
              height: 50px;
            }
          </style>
          <script>
            document.addEventListener('DOMContentLoaded', async () => {
              document.getElementById('inputGroupFile01').addEventListener('change', function (e) {
                var fileName = e.target.files[0].name;
                // Do something with the file name, like displaying it somewhere
                alert("File chosen: " + fileName);
              });
            });
          </script>
          <input type="text" id="inputMessage" class="form-control form-control-lg" placeholder="Type your message...">
          <button id="sendButton" class="btn btn-primary">Send</button>
        </div>
      </div>
    </div>
  </section>
  <div id="dialpad"></div>
  <section>
    <div id="canvas-container"></div>
    <div class="canvas-container">
      <div id="graph"></div>
    </div>
  </section>
  <div id="command-manager" class="container" style="display: grid!;width: 100%;grid-template-columns: 1fr 1fr 1fr;">
  </div>
  <style>
    #command-manager {
      display: grid;
      align-items: center;
      justify-content: center;
      text-align: center;
      gap: 1rem;
      grid-template-columns: 1fr 1fr 1fr 1fr;
    }
  </style>
</body>
<script src="node_modules/eruda/eruda.js"></script>
<script>eruda.init();</script>
<script src="//unpkg.com/force-graph"></script>
<!-- <script src="../../dist/force-graph.js"></script> -->
<!-- <script>
    // const elem = document.querySelector('canvas');
  fetch('../datasets/miserables.json').then(res => res.json()).then(data => {
    const elem = document.getElementById('graph');

    const Graph = ForceGraph()(elem)
      .graphData(data)
      // .width('600px')
      // .height('400px')
      // .cooldownTicks(1000)
    .nodeLabel('id')
    .nodeRelSize(8)
    .nodeAutoColorBy('group')
    // .linkDirectionalParticles(2)
    // .linkDirectionalParticleWidth(1.4)
    // .backgroundColor('#F5F5FF')
    // .height(elem.parentElement().innerHeight - 60)
    .onNodeClick(node => {
      // Center/zoom on node
      Graph.centerAt(node.x, node.y, 1000);
      Graph.zoom(8, 2000);
    });
    // Graph.d3Force('center', elem.width / 2, elem.height / 2);
    Graph.onEngineStop(() => Graph.zoomToFit(100));
    elementResizeDetectorMaker().listenTo(
      document.getElementById('graph'),
      el => Graph.width(el.offsetWidth)
    );
  });

</script>
<script type="module">

  import * as d3 from "https://cdn.jsdelivr.net/npm/d3@7/+esm";
  // import {forceSimulation, forceCollide, forceX} from "https://cdn.jsdelivr.net/npm/d3-force@3/+esm";
  // Specify the dimensions of the chart.
  const width = 928;
  const height = 680;

  // Specify the color scale.
  const color = d3.scaleOrdinal(d3.schemeCategory10);

  // The force simulation mutates links and nodes, so create a copy
  // so that re-evaluating this cell produces the same result.
  const links = data.links.map(d => ({...d}));
  const nodes = data.nodes.map(d => ({...d}));

  // Create a simulation with several forces.
  const simulation = d3.forceSimulation(nodes)
      .force("link", d3.forceLink(links).id(d => d.id))
      .force("charge", d3.forceManyBody())
      .force("x", d3.forceX())
      .force("y", d3.forceY());

  // Create the SVG container.
  const svg = d3.create("svg")
      .attr("width", width)
      .attr("height", height)
      .attr("viewBox", [-width / 2, -height / 2, width, height])
      .attr("style", "max-width: 100%; height: auto;");

  // Add a line for each link, and a circle for each node.
  const link = svg.append("g")
      .attr("stroke", "#999")
      .attr("stroke-opacity", 0.6)
    .selectAll("line")
    .data(links)
    .join("line")
      .attr("stroke-width", d => Math.sqrt(d.value));

  const node = svg.append("g")
      .attr("stroke", "#fff")
      .attr("stroke-width", 1.5)
    .selectAll("circle")
    .data(nodes)
    .join("circle")
      .attr("r", 5)
      .attr("fill", d => color(d.group));

  node.append("title")
      .text(d => d.id);

  // Add a drag behavior.
  node.call(d3.drag()
        .on("start", dragstarted)
        .on("drag", dragged)
        .on("end", dragended));
  
  // Set the position attributes of links and nodes each time the simulation ticks.
  simulation.on("tick", () => {
    link
        .attr("x1", d => d.source.x)
        .attr("y1", d => d.source.y)
        .attr("x2", d => d.target.x)
        .attr("y2", d => d.target.y);

    node
        .attr("cx", d => d.x)
        .attr("cy", d => d.y);
  });

  // Reheat the simulation when drag starts, and fix the subject position.
  function dragstarted(event) {
    if (!event.active) simulation.alphaTarget(0.3).restart();
    event.subject.fx = event.subject.x;
    event.subject.fy = event.subject.y;
  }

  // Update the subject (dragged node) position during drag.
  function dragged(event) {
    event.subject.fx = event.x;
    event.subject.fy = event.y;
  }

  // Restore the target alpha so the simulation cools after dragging ends.
  // Unfix the subject position now that it’s no longer being dragged.
  function dragended(event) {
    if (!event.active) simulation.alphaTarget(0);
    event.subject.fx = null;
    event.subject.fy = null;
  }

  // When this cell is re-run, stop the previous simulation. (This doesn’t
  // really matter since the target alpha is zero and the simulation will
  // stop naturally, but it’s a good practice.)
  invalidation.then(() => simulation.stop());

    // .force("collide", forceCollide(5))
    // .on("tick", () => console.log(nodes[0].x));
  // Append the SVG element.
  const container = document.getElementById("canvas-container")
  container.append(svg.node());
  
  </script> -->
<!-- <style>
  .force-graph-container > canvas{
    height: 100px;
    width: 200px;
  }
</style> -->

</html>